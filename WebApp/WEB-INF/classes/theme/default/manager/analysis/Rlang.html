
<body> 
  ${navbar!""}
  <div class="main-container" id="main-container"> 
   <script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script> 
   <div class="main-container-inner"> 
    
    ${menu!""}
     <div class="main-content"> 
     <div class="breadcrumbs" id="breadcrumbs"> 
      <script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script> 
      <ul class="breadcrumb"> 
       <li> <i class="icon-home home-icon"></i> <a href="#">首页</a> </li> 
       <li class="active">${name}</li> 
      </ul> 
      <!-- #nav-search --> 
     </div> 
     <div class="page-content"> 
      <!-- /.page-header --> 
      <div class="row"> 
      	<div class="col-xs-12 ">
	      	<#if error??>
			<div class="alert alert-danger">
				<button data-dismiss="alert" class="close" type="button">
					<i class="icon-remove"></i>
				</button>
				<strong> <i class="icon-remove"></i> Oh Bug!
				</strong> ${error!""}. <br />
			</div>
			</#if>
			<div class="col-xs-6">
			   	<div class="col-xs-12 well">				
					<textarea id="r_query" name="r_query"  rows="20" cols="100" style="width:98%;"></textarea>	
				</div>
				<div class="col-xs-12">
				<h3 class="header smaller lighter blue">
						[<a href="javascript:void(0)" onclick="ScriptR()">查询</a>] <small>结果:
						</small>
					</h3>
				</div>
			  	<div class="col-xs-12"> 
        
			       
			        <h5><span id="json_result" name="json_result"></span></h5> 
			       
		      	</div>		
			</div>
			<div class="col-xs-6">
				<div class="widget-box">
					<div class="widget-header widget-header-flat">
						<h4 class="smaller">
							<i class="icon-code"></i>
							帮助:<span id="cname" name="cname"></span>
						</h4>
					</div>
	
					<div class="widget-body">
						<div class="widget-main">
							<pre class="prettyprint linenums" id="tips" name="tips"></pre>
						</div>
					</div>
				</div>			
			</div>
	    </div>

       
     </div> 
     <!-- /.row --> 
    <!-- /.main-content --> 
    
   </div> 
   <!-- /.main-container-inner --> 
   <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse"> <i class="icon-double-angle-up icon-only bigger-110"></i> </a> 
  </div> 
  <!-- /.main-container --> 
  
  <script language="Javascript" type="text/javascript" src="${static_js_uri}/textline/jquery-linedtextarea.js"></script>
    <script type="text/javascript" src="${static_js_uri}/pretty_json/underscore-min.js" ></script>
  <script type="text/javascript" src="${static_js_uri}/pretty_json/backbone-min.js" ></script>
  <script type="text/javascript" src="${static_js_uri}/pretty_json/pretty-json-min.js" ></script>
  <script src="${static_js_uri}/textcomplete/jquery.textcomplete.min.js"></script> 

    
    
  <script type="text/javascript">
  
  
  
jQuery(function($) {
	
		var completes = [
							{
							mongo : ${r_key_list},
					    	match: /\b([a-zA-Z._]{2,})$/,
					        search: function (term, callback) {
					            callback($.map(this.mongo, function (element) {
					                return element.indexOf(term) === 0 ? element : null;
					            }));
					        },
					        index: 1,
					        replace: function (element) {
					            return [element+'(',  ')'];
					        }
					    },
					    					    
					];	
		$('#r_query').textcomplete(completes);

		$("#r_query").linedtextarea(
				{selectedLine: 1}
			);
		 
		
	});
	
	$(document).on("keyup", function(e) {
		
	    var code = e.which;
	    if (code == 40) {
	    	var val = $(".textcomplete-item.active").html();	   		
            val = val.trim();
            val = val.substr(3, val.length-7);
        	//console.log(val);
        	$("#cname").html(val);
	    	getKeyTip(val);
	    } else if (code == 38) {
	    	var val = $(".textcomplete-item.active").html();	   		
            val = val.trim();
            val = val.substr(3, val.length-7);
        	//console.log(val);
        	$("#cname").html(val);
	    	getKeyTip(val);
	    }
	                
	});
	
	function getKeyTip(o){
		$.ajax({
			  url: "${search_url}?jsoncallback=?",
			  contentType: 'text/html;charset=utf-8',
			  
			  data:{"key":o},
			  success: function(result){
				  console.log("success"+result);
			  },
			  error: function(request, textStatus, errorThrown) {
			    //alert(textStatus);
			  },
			  complete: function(request, textStatus) { //for additional info
				  var option = request.responseText;
				  //option = option.replace(/[\r\n]/g, "");							  
				  
				  console.log("success:"+option);
				  $("#tips").html(option);
			  }
			});
	}
	
	function ScriptR(){
		$.ajax({
			  url: "${script_url}?jsoncallback=?",
			  contentType: 'text/html;charset=utf-8',			  
			  data:{"query":$("#r_query").val()},
			  success: function(result){
				  console.log("success"+result);
			  },
			  error: function(request, textStatus, errorThrown) {
			    //alert(textStatus);
			  },
			  complete: function(request, textStatus) { //for additional info
				  var option = request.responseText;
				 // option = option.replace(/[\r\n]/g, "<br />");							  
				  
				  console.log("success:"+option);
				  
				 
				  var json_res = JSON.parse(option);
					
					
				  var node = new PrettyJSON.view.Node({
					  el:$('#json_result'),
					  data:json_res
				  });
					
				  node.expandAll();
				 /// $("#json_result").html(option);
			  }
			});
	}
</script>  
 